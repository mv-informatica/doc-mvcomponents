{"version":3,"sources":["../src/core/validator.ts"],"names":[],"mappings":"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","file":"validator.js","sourcesContent":["import {IConfigurable} from \"./interface/i-configurable\";\r\nimport {IValidator} from \"./interface/i-validator\";\r\nimport {IAsyncValidation, ISyncValidation,IValidation} from \"./interface/i-validation\";\r\nimport {EventEmitter} from \"./event-emitter\";\r\n\r\nexport class Validator<T> implements IValidator<T>, IConfigurable {\r\n\tpublic onValidate: EventEmitter<string[]> = new EventEmitter<string[]>();\r\n\tprivate sync: ISyncValidation<T>[]=[];\r\n\tprivate async: IAsyncValidation<T>[]=[];\r\n\r\n\tpublic configure(method: (me: this) => any): this {\r\n\t\tmethod(this);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic add(...validations: ISyncValidation<T>[]): this {\r\n\t\tif(!this.sync){\r\n\t\t\tthis.sync = [];\r\n\t\t}\r\n\t\tthis.sync.push.apply(this.sync, validations);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tpublic addAsync(...validations: IAsyncValidation<T>[]): this {\r\n\t\tif(!this.async){\r\n\t\t\tthis.async = [];\r\n\t\t}\r\n\t\tthis.async.push.apply(this.async, validations);\r\n\t\treturn this;\r\n\t}\r\n\r\n\tprivate checkToCancel(){\r\n\t\tlet syncToCancel = this.sync.filter(valid => valid.isCanceled);\r\n\t\tif(syncToCancel.length){\r\n\t\t\tthis.remove(...syncToCancel);\r\n\t\t}\r\n\t\tlet asyncToCancel = this.async.filter(valid => valid.isCanceled);\r\n\t\tif(asyncToCancel.length){\r\n\t\t\tthis.remove(...asyncToCancel);\r\n\t\t}        \r\n\t}\r\n\r\n\tpublic validate(value: T): Promise<string[]> {\r\n\t\tthis.checkToCancel();\r\n\t\treturn new Promise<string[]>((resolve, reject) => {\r\n\t\t\tlet errors = this.sync\r\n\t\t\t\t.filter(validation => !validation.validate(value))\r\n\t\t\t\t.map(validation => validation.getMessage(value));\r\n\r\n\t\t\tPromise.all(this.async.map(validation => validation.validate(value)))\r\n\t\t\t\t.then(data => {\r\n\t\t\t\t\terrors.push.apply(errors, data\r\n\t\t\t\t\t\t.map((isValid, index) => isValid ? null : this.async[index].getMessage(value))\r\n\t\t\t\t\t\t.filter(error => !!error));\r\n\r\n\t\t\t\t\tthis.onValidate.emit(errors);                    \r\n\t\t\t\t\tif(errors && errors.length){\r\n\t\t\t\t\t\treject(errors);\r\n\t\t\t\t\t}else{\r\n\t\t\t\t\t\tresolve(errors);\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch(reject);\r\n\t\t});\r\n\t}\r\n\r\n\tpublic remove(...validations: IValidation< T, boolean | Promise<boolean> >[]): this {\r\n\t\tlet isSync = true;\r\n\t\tconst removeValidation = (validation:IValidation<T,boolean | Promise<boolean> >,index:number) => { \r\n\t\t\tif(\r\n\t\t\t\tvalidations\r\n\t\t\t\t\t.filter(valids=>valids[\"tokenId\"]===validation[\"tokenId\"])\r\n\t\t\t\t\t.length\r\n\t\t\t){\r\n\t\t\t\tif(isSync){\r\n\t\t\t\t\tthis.sync.splice(index,1);\r\n\t\t\t\t}else{\r\n\t\t\t\t\tthis.async.splice(index,1);\r\n\t\t\t\t}\t\t\t\t\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t};\r\n\t\tthis.sync.some(removeValidation);\r\n\t\tisSync = false;\r\n\t\tthis.async.some(removeValidation);\r\n\t\treturn this;\r\n\t}\r\n}\r\n"]}